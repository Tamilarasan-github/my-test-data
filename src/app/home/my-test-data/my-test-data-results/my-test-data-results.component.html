<button class="collapsible">Test Data Search Results</button>

<div class="container">

    <div class="d-flex justify-content-md-evenly flex-wrap mt-3">

        <button type="button" class="secondary-btn">
            <i class="bi bi-plus-square-fill"></i>
        </button>


        <ng-template #cloneSelectedTestDataModal>
            <div class="modal-header">
                Clone Selected Test Data Records
            </div>
            <div class="m-3">
                Are you sure do you want to clone/copy the selected test data records?
            </div>
            <div class="modal-footer">
                <button type="button" class="primary-btn" (click)="cloneSelectedTestData()">Clone</button>
            </div>
        </ng-template>


       
        <ng-template #deleteSelectedTestDataModal>
            <div class="modal-header">
                Delete Selected Test Data Records
            </div>
            <div class="m-3">
                Are you sure do you want to delete the selected test data records?
            </div>
            <div class="modal-footer">
                <button type="button" class="primary-btn" (click)="deleteSelectedTestData()">Delete</button>
            </div>
        </ng-template>



        <div ngbDropdown [autoClose]="false">
        <button ngbDropdownToggle type="button" class="secondary-btn" >
            Selected Records
        </button>
        <div ngbDropdownMenu> 
            <span ngbDropdownItem (click)="openModal(cloneSelectedTestDataModal)"> Clone </span>
            <span ngbDropdownItem (click)="openModal(deleteSelectedTestDataModal)"> Delete </span>
            <span ngbDropdownItem (click)="openModal(updateRunFlagSelectedTestDataModal)"> Update Run Flag </span>
                     
        </div>
        </div>
        <ng-template #updateRunFlagSelectedTestDataModal>
            <div class="modal-header">
                Update Run Flag
            </div>
            <div class="m-3">
                <span> Please select the "Run Flag" value to be updated.</span>
               
                <input class="radio" type="radio"> <label>Yes</label>
                <input class="radio" type="radio"> <label>No</label>
            </div>
            <div class="modal-footer">
                <button type="button" class="primary-btn" (click)="updateRunFlagForSelectedTestData()">Update</button>
            </div>
        </ng-template>
       
        <div ngbDropdown [autoClose]="false">
            <button ngbDropdownToggle type="button" class="secondary-btn">
                Select UI Screen Name<i class="fa fa-solid fa-download"></i>
            </button>
            <div ngbDropdownMenu class="custom-dropdown">
                <input class="search-txtbox" type="text " placeholder="Search Columns"
                    (input)="searchColumnsInDropdown($event)">
                <div ngbDropdownItem class="dropdown-item" *ngFor="let uiScreenName of testDataAppOneUIScreenNamesInfo">

                    <input class="columns-dropdown-checkbox btn-transparent" type="checkbox"
                        (change)="updateColumnsVisibleByUIScreenName($event, uiScreenName)">
                    <!-- <label class="columns-dropdown-label" *ngIf="field.key==='field_name'">field</label> -->
                    <label class="columns-dropdown-label">{{uiScreenName}}</label>

                </div>
            </div>
        </div>

        <div ngbDropdown [autoClose]="false">
            <button ngbDropdownToggle type="button" class="secondary-btn">
                Select Fields
            </button>

            <div ngbDropdownMenu class="custom-dropdown">
                <input class="search-txtbox" type="text " placeholder="Search Columns"
                    (input)="searchColumnsInDropdown($event)">
                <div ngbDropdownItem class="dropdown-item" *ngFor="let field of testFields">

                    <input class="columns-dropdown-checkbox btn-transparent" type="checkbox"
                        [checked]="checked(field.field_id)" (change)="updateColumnsVisible($event, field)">
                    <!-- <label class="columns-dropdown-label" *ngIf="field.key==='field_name'">field</label> -->
                    <label class="columns-dropdown-label">{{field.field_name}}</label>

                </div>
            </div>
        </div>

        <!-- <div ngbDropdown [autoClose]="false">
            <button ngbDropdownToggle type="button" class="btn btn-primary btn-transparent">
                <svg xmlns="http://www.w3.org/2000/svg " width="16 " height="16 " fill="currentColor "
                    class="bi bi-list-columns-reverse " viewBox="0 0 16 16 ">
                    <path fill-rule="evenodd " d="M0 .5A.5.5 0 0 1 .5 0h2a.5.5 0 0 1 0 1h-2A.5.5 0 0 1 0 .5Zm4 0a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1h-10A.5.5 0 0 1 4 .5Zm-4 2A.5.5 0 0 1 .5 2h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5
                    0 0 1-.5-.5Zm-4 2A.5.5 0 0 1 .5 4h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5Zm-4 2A.5.5 0 0 1 .5 6h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 0 1h-8a.5.5
                    0 0 1-.5-.5Zm-4 2A.5.5 0 0 1 .5 8h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 0 1h-8a.5.5 0 0 1-.5-.5Zm-4 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1h-10a.5.5
                    0 0 1-.5-.5Zm-4 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5Zm-4 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5
                    0 0 1-.5-.5Z " />
                </svg>
            </button>

            <div ngbDropdownMenu class="custom-dropdown">
                <input class="search-txtbox" type="text" placeholder="Search Columns"
                    (input)="searchColumnsInDropdown($event)">
                <div ngbDropdownItem class="dropdown-item" *ngFor="let field of testDataAppOneTableOneFieldsInfo">

                    <input class="columns-dropdown-checkbox" type="checkbox"
                        (change)="updateColumnsVisible($event, field)">
                    <label class="columns-dropdown-label">{{field.field_name}}</label>
                </div>
            </div>
        </div> -->

        <div ngbDropdown>
            <button ngbDropdownToggle type="button" class="secondary-btn">
                More
                <i class="fa fa-solid fa-person-running"></i>
            </button>
            <div ngbDropdownMenu>
                <a ngbDropdownItem (click)="openModal(downloadTemplate)"> Download Template </a>
                <ng-template #downloadTemplate>
                    <div class="modal-header">
                        Download Template
                    </div>
                    <div class="m-3">
                        Are you sure you want to download a template?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="primary-btn" (click)="downloadTestDataTemplate()">Download</button>
                    </div>
                </ng-template>
                <a ngbDropdownItem (click)="openModal(exportAsExcel)"> Export as Excel </a>
                <ng-template #exportAsExcel>
                    <div class="modal-header">
                        Export As Excel
                    </div>
                    <div class="m-3">
                        Export may take some time based on the data!
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="primary-btn" (click)="exportTestDataSearchResults()">Export</button>
                    </div>
                </ng-template>
                <a ngbDropdownItem (click)="openModal(uploadFromExcel)"> Upload from Excel </a>
                <ng-template #uploadFromExcel>
                    <div class="modal-header">
                        Upload Data From Excel
                    </div>
                    <div class="m-3">
                        <label class="label">Select the Excel file to upload</label> <br>
                        <input class="form-control" type="file">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="primary-btn" >Upload</button>
                    </div>
                </ng-template>
            </div>

        </div>
    </div>


    <div class="d-flex justify-content-center mt-3">
        <ngb-pagination [collectionSize]="dataCollectionSize" [(page)]="page" [pageSize]="pageSize" [maxSize]="5"
            [rotate]="true" [boundaryLinks]="true" (pageChange)="pageChange()">
        </ngb-pagination>
    </div>
</div>


<div class="table-responsive scrollable-div">

    <table class="table table-borderless table-hover">

        <thead class="table-header">
            <th class="table-header-cols"> <input type="checkbox"> </th>
            <th class="table-header-cols"> ACTIONS </th>
           
            <ng-container *ngFor="let field of testDataMetaAppOneFieldsInfo">
                <th class="table-header-cols" *ngIf="showTestDataMetaFieldValue(field.field_name_api)">
                    <input type="checkbox" checked (change)="updateColumnsVisible($event, field)"> {{field.field_name}}
                </th>
            </ng-container>
            <ng-container *ngIf="selectedTestTableId===2001">
                <ng-container *ngFor="let field of testDataAppOneTableOneFieldsInfo">
                    <th class="table-header-cols" *ngIf="showTestDataMetaFieldValue(field.field_name_api)">
                        <input type="checkbox" checked (change)="updateColumnsVisible($event, field)">
                        {{field.field_name}}
                    </th>
                </ng-container>
            </ng-container>
            <ng-container *ngIf="selectedTestTableId===2002">
                <ng-container *ngFor="let field of testDataAppOneTableTwoFieldsInfo">
                    <th class="table-header-cols" *ngIf="showTestDataMetaFieldValue(field.field_name_api)">
                        <input type="checkbox" checked (change)="updateColumnsVisible($event, field)">
                        {{field.field_name}}
                    </th>
                </ng-container>
            </ng-container> 


        </thead>
        <!-- <thead>
                <th> <input type="checkbox"> </th>
                <th> ACTIONS </th>
                <th *ngFor="let header of headers(listOfTestDataReceived[0])">{{header}}</th>
            </thead> -->
        <tbody class="table-body">

            <ng-container
                *ngFor="let testDataMetaRecord of testDataMetaValuesAsObjectList | slice: (page-1) * pageSize : (page-1) * pageSize + pageSize">
                <ng-container *ngIf="selectedTestTableId===2001">
                    <tr *ngFor="let testDataAppOneTableOneRecord of testDataMetaRecord.testDataAppOneTableOne"
                        (dblclick)="onEdit($event, testDataMetaRecord, testDataAppOneTableOneRecord)">

                        <td> <input type="checkbox" (change)="checkboxActions($event, testDataMetaRecord)"> </td>
                        <td>
                            <div class="d-flex justify-content-center">
                                <div>
                                    <i class='bi bi-pencil-square  m-2'
                                        *ngIf="currentlyInEditTestDataMetaRecord!=testDataMetaRecord"
                                        (click)="onEdit($event, testDataMetaRecord, testDataAppOneTableOneRecord)"></i>

                                    <i class='bi bi-trash3-fill m-2'
                                        *ngIf="currentlyInEditTestDataMetaRecord!=testDataMetaRecord"
                                        (click)="onDelete($event, testDataMetaRecord, testDataAppOneTableOneRecord)"></i>

                                    <i class='bi bi-x-circle-fill  m-2'
                                        *ngIf="currentlyInEditTestDataMetaRecord===testDataMetaRecord"
                                        (click)="onCancel($event, testDataMetaRecord, testDataAppOneTableOneRecord)"></i>

                                    <i class='bi bi-box-arrow-down  m-2'
                                        *ngIf="currentlyInEditTestDataMetaRecord===testDataMetaRecord"
                                        (click)="onUpdate($event, testDataMetaRecord, testDataAppOneTableOneRecord)"></i>
                                </div>
                                <div>
                                    <i class='mx-2 fa fa-plus cancel-icon'
                                        (click)="onAdd($event, testDataMetaRecord, testDataAppOneTableOneRecord)"></i>
                                </div>
                            </div>
                        </td>
                        <ng-container
                            *ngFor="let testDataMetaColumn of testDataMetaRecord| keyvalue:myMetaDataTestFieldsSortOrder">
                            <!-- <td *ngIf="columnsSelectedList.includes(getFieldUsingDbColumnName(testDataMetaColumn.key))"> -->
                            <td *ngIf="showTestDataMetaFieldValue(testDataMetaColumn.key)">
                                <ng-container>
                                    <textarea *ngIf="currentlyInEditTestDataMetaRecord!=testDataMetaRecord"
                                        [disabled]="true" [(ngModel)]=testDataMetaColumn.value
                                        name={{testDataMetaColumn.key}} [ngClass]=" 'table-textarea' ">
                                </textarea>
                                    <textarea #currentTestDataRow
                                        *ngIf="currentlyInEditTestDataMetaRecord===testDataMetaRecord"
                                        value={{testDataMetaColumn.value}} name={{testDataMetaColumn.key}}
                                        (change)="updateExistingTestDataMetaDetails($event, testDataMetaRecord)"
                                        [ngClass]=" 'table-textarea-edit' ">
                                </textarea>
                                </ng-container>
                            </td>
                        </ng-container>
                        <ng-container
                            *ngFor="let singleTestDataAppOneTableOneRecord of testDataAppOneTableOneRecord | keyvalue:unsorted">
                            <!-- <td *ngIf="columnsSelectedList.includes(singleTestDataAppOneTableOneRecord.key)"> -->
                            <td *ngIf="showTestDataMetaFieldValue(singleTestDataAppOneTableOneRecord.key)">
                                <textarea *ngIf="currentlyInEditTestDataMetaRecord!=testDataMetaRecord"
                                    [disabled]="true" name={{singleTestDataAppOneTableOneRecord.key}}
                                    [(ngModel)]=singleTestDataAppOneTableOneRecord.value [ngClass]=" 'table-textarea' ">
                                </textarea>
                                <!-- value={{singleTestDataAppOneTableOneRecord.value}} name={{singleTestDataAppOneTableOneRecord.key}} -->
                                <textarea #currentTestDataRow
                                    *ngIf="currentlyInEditTestDataMetaRecord===testDataMetaRecord"
                                    value={{singleTestDataAppOneTableOneRecord.value}}
                                    name={{singleTestDataAppOneTableOneRecord.key}}
                                    (change)="updateTestDataAppOneTableOneDetails($event, testDataAppOneTableOneRecord)"
                                    [ngClass]=" 'table-textarea-edit'">
                                </textarea>
                            </td>

                        </ng-container>
                    </tr>
                </ng-container>
                <ng-container *ngIf="selectedTestTableId===2002">
                    <tr *ngFor="let testDataAppOneTableTwoRecord of testDataMetaRecord.testDataAppOneTableTwo">

                        <td> <input type="checkbox" (change)="checkboxActions($event, testDataMetaRecord)"> </td>
                        <td>
                            <div class="d-flex justify-content-center">
                                <div>

                                    <i class='mx-2 fas fa-edit edit-icon'
                                        *ngIf="currentlyInEditTestDataMetaRecord!=testDataMetaRecord"
                                        (click)="onEdit($event, testDataMetaRecord, testDataAppOneTableTwoRecord)"></i>

                                    <i class='mx-2 fas fa-trash delete-icon'
                                        *ngIf="currentlyInEditTestDataMetaRecord!=testDataMetaRecord"
                                        (click)="onDelete($event, testDataMetaRecord, testDataAppOneTableTwoRecord)"></i>

                                    <i class='mx-2 fa fa-times cancel-icon'
                                        *ngIf="currentlyInEditTestDataMetaRecord===testDataMetaRecord"
                                        (click)="onCancel($event, testDataMetaRecord, testDataAppOneTableTwoRecord)"></i>

                                    <i class='mx-2 fa fa-save save-icon'
                                        *ngIf="currentlyInEditTestDataMetaRecord===testDataMetaRecord"
                                        (click)="onUpdate($event, testDataMetaRecord, testDataAppOneTableTwoRecord)"></i>
                                </div>
                                <div>
                                    <i class='mx-2 fa fa-plus cancel-icon'
                                        (click)="onCancel($event, testDataMetaRecord, testDataAppOneTableTwoRecord)"></i>
                                </div>
                            </div>
                        </td>
                        <ng-container
                            *ngFor="let testDataMetaColumn of testDataMetaRecord| keyvalue:myMetaDataTestFieldsSortOrder">
                            <!-- <td *ngIf="columnsSelectedList.includes(getFieldUsingDbColumnName(testDataMetaColumn.key))"> -->
                            <td *ngIf="showTestDataMetaFieldValue(testDataMetaColumn.key)">
                                <ng-container>
                                    <textarea *ngIf="currentlyInEditTestDataMetaRecord!==testDataMetaRecord"
                                        [disabled]="true" [(ngModel)]=testDataMetaColumn.value
                                        name={{testDataMetaColumn.key}} [ngClass]="'table-textarea'">
                                </textarea>
                                    <textarea #currentTestDataRow
                                        *ngIf="currentlyInEditTestDataMetaRecord===testDataMetaRecord"
                                        value={{testDataMetaColumn.value}} name={{testDataMetaColumn.key}}
                                        (change)="updateExistingTestDataMetaDetails($event, testDataMetaRecord)"
                                        [ngClass]=" 'table-textarea-edit' ">
                                </textarea>
                                </ng-container>
                            </td>
                        </ng-container>
                        <ng-container
                            *ngFor="let singleTestDataAppOneTableTwoRecord of testDataAppOneTableTwoRecord | keyvalue:unsorted">
                            <!-- <td *ngIf="columnsSelectedList.includes(singleTestDataAppOneTableOneRecord.key)"> -->
                            <td *ngIf="showTestDataMetaFieldValue(singleTestDataAppOneTableTwoRecord.key)">
                                <textarea *ngIf="currentlyInEditTestDataMetaRecord!=testDataMetaRecord"
                                    [disabled]="true" name={{singleTestDataAppOneTableTwoRecord.key}}
                                    [(ngModel)]=singleTestDataAppOneTableTwoRecord.value [ngClass]=" 'table-textarea' ">
                                </textarea>
                                <textarea #currentTestDataRow
                                    *ngIf="currentlyInEditTestDataMetaRecord===testDataMetaRecord"
                                    value={{singleTestDataAppOneTableTwoRecord.value}}
                                    name={{singleTestDataAppOneTableTwoRecord.key}}
                                    (change)="updateTestDataAppOneTableOneDetails($event, testDataAppOneTableTwoRecord)"
                                    [ngClass]=" 'table-textarea-edit' ">
                            </textarea>
                            </td>

                        </ng-container>
                    </tr>
                </ng-container>
            </ng-container>

        </tbody>
    </table>
</div>